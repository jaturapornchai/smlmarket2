# ЁЯЧДя╕П Database Scripts р╕кр╕│р╕лр╕гр╕▒р╕Ър╕гр╕░р╕Ър╕Ър╕Хр╕гр╕░р╕Бр╕гр╣Йр╕▓

## ЁЯУБ р╣Др╕Яр╕ер╣Мр╣Гр╕Щр╣Вр╕Яр╕ер╣Ар╕Фр╕нр╕гр╣Мр╕Щр╕╡р╣Й

### `cart_system_postgresql.sql`
**PostgreSQL Script р╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╕гр╣Йр╕▓р╕Зр╕гр╕░р╕Ър╕Ър╕Хр╕гр╕░р╕Бр╕гр╣Йр╕▓**

## ЁЯЪА р╕зр╕┤р╕Шр╕╡р╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ

### 1. **р╣Ар╕Ыр╕┤р╕Ф pgAdmin р╕лр╕гр╕╖р╕н PostgreSQL Query Tool**

### 2. **Run Script**
```sql
-- Copy р╣Бр╕ер╕░ Paste р╣Вр╕Др╣Йр╕Фр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Фр╕Ир╕▓р╕Бр╣Др╕Яр╕ер╣М cart_system_postgresql.sql
-- р╕Ир╕▓р╕Бр╕Щр╕▒р╣Йр╕Щ Execute
```

### 3. **р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М**
Script р╕Ир╕░р╣Бр╕кр╕Фр╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б:
```
Cart system tables created successfully!
```

## ЁЯУК р╣Вр╕Др╕гр╕Зр╕кр╕гр╣Йр╕▓р╕Зр╕Чр╕╡р╣Ир╕кр╕гр╣Йр╕▓р╕З

### ЁЯЧГя╕П **Tables (р╕Хр╕▓р╕гр╕▓р╕З):**
1. **`carts`** - р╕Хр╕гр╕░р╕Бр╕гр╣Йр╕▓р╕лр╕ер╕▒р╕Б
2. **`cart_items`** - р╕кр╕┤р╕Щр╕Др╣Йр╕▓р╣Гр╕Щр╕Хр╕гр╕░р╕Бр╕гр╣Йр╕▓
3. **`orders`** - р╕Др╕│р╕кр╕▒р╣Ир╕Зр╕Лр╕╖р╣Йр╕н
4. **`order_items`** - р╕гр╕▓р╕вр╕Бр╕▓р╕гр╕кр╕┤р╕Щр╕Др╣Йр╕▓р╣Гр╕Щр╕Др╕│р╕кр╕▒р╣Ир╕Зр╕Лр╕╖р╣Йр╕н

### ЁЯУИ **Indexes (р╕Фр╕▒р╕Кр╕Щр╕╡):**
- Primary Keys р╣Бр╕ер╕░ Foreign Keys
- Indexes р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╕Др╣Йр╕Щр╕лр╕▓р╕Чр╕╡р╣Ир╣Ар╕гр╣Зр╕з
- Unique constraints

### тЪб **Triggers (р╕Чр╕гр╕┤р╕Бр╣Ар╕Бр╕нр╕гр╣М):**
- Auto-update `updated_at` fields
- Data validation

### ЁЯФз **Functions (р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щ):**
- `update_cart_totals()` - р╕нр╕▒р╕Юр╣Ар╕Фр╕Чр╕вр╕нр╕Фр╕гр╕зр╕бр╕Хр╕гр╕░р╕Бр╕гр╣Йр╕▓
- `generate_order_number()` - р╕кр╕гр╣Йр╕▓р╕Зр╕лр╕бр╕▓р╕вр╣Ар╕ер╕Вр╕Др╕│р╕кр╕▒р╣Ир╕Зр╕Лр╕╖р╣Йр╕н

### ЁЯУЛ **Views (р╕зр╕┤р╕з):**
- `v_cart_details` - р╕Фр╕╣р╕Хр╕гр╕░р╕Бр╕гр╣Йр╕▓р╕Юр╕гр╣Йр╕нр╕бр╕кр╕┤р╕Щр╕Др╣Йр╕▓
- `v_order_details` - р╕Фр╕╣р╕Др╕│р╕кр╕▒р╣Ир╕Зр╕Лр╕╖р╣Йр╕нр╕Юр╕гр╣Йр╕нр╕бр╕гр╕▓р╕вр╕Бр╕▓р╕г

## тЪая╕П р╕Др╕│р╣Ар╕Хр╕╖р╕нр╕Щ

**Script р╕Щр╕╡р╣Йр╕Ир╕░ DROP (р╕ер╕Ъ) р╕Хр╕▓р╕гр╕▓р╕Зр╣Ар╕Бр╣Ир╕▓р╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф!**
- `order_items`
- `cart_items` 
- `orders`
- `carts`

р╕Бр╕гр╕╕р╕Ур╕▓ **Backup р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕кр╕│р╕Др╕▒р╕Н** р╕Бр╣Ир╕нр╕Щр╕гр╕▒р╕Щ Script

## ЁЯФЧ р╕Др╕зр╕▓р╕бр╕кр╕▒р╕бр╕Юр╕▒р╕Щр╕Шр╣М

```
carts (1) тФАтФАтФАтФА (N) cart_items
carts (1) тФАтФАтФАтФА (1) orders  
orders (1) тФАтФАтФАтФА (N) order_items
```

## ЁЯУЭ р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ

### р╣Ар╕Юр╕┤р╣Ир╕бр╕кр╕┤р╕Щр╕Др╣Йр╕▓р╣Ар╕Вр╣Йр╕▓р╕Хр╕гр╕░р╕Бр╕гр╣Йр╕▓:
```sql
INSERT INTO cart_items (cart_id, product_id, barcode, unit_code, quantity, unit_price, total_price)
VALUES (1, 123, '1234567890', 'PCS', 2, 50.00, 100.00);

-- р╕нр╕▒р╕Юр╣Ар╕Фр╕Чр╕вр╕нр╕Фр╕гр╕зр╕бр╕Хр╕гр╕░р╕Бр╕гр╣Йр╕▓
SELECT update_cart_totals(1);
```

### р╕кр╕гр╣Йр╕▓р╕Зр╕Др╕│р╕кр╕▒р╣Ир╕Зр╕Лр╕╖р╣Йр╕н:
```sql
INSERT INTO orders (cart_id, user_id, order_number, total_amount)
VALUES (1, 1001, generate_order_number(), 100.00);
```

### р╕Фр╕╣р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Хр╕гр╕░р╕Бр╕гр╣Йр╕▓:
```sql
SELECT * FROM v_cart_details WHERE user_id = 1001;
```

### р╕Фр╕╣р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Др╕│р╕кр╕▒р╣Ир╕Зр╕Лр╕╖р╣Йр╕н:
```sql
SELECT * FROM v_order_details WHERE user_id = 1001;
```
